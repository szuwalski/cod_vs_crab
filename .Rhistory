cod_dat_raw <- read_csv(here("data","race_length_by_haul_PACIFIC_COD.zip"))
# Compile cod data
library(tidyverse)
library(here)
here <- here::here()
cod_dat_raw <- read_csv(here("data","race_length_by_haul_PACIFIC_COD.zip"))
problesm(cod_dat_raw)
head(problems(cod_dat_raw))
?read_zip
?read_csv
cod_dat_raw <- read_csv(here("data","race_length_by_haul_PACIFIC_COD.zip"),skip=7)
spec(cod_dat_raw)
cod_dat_raw <- read_csv(here("data","race_length_by_haul_PACIFIC_COD.zip"),skip=7,col_types = cols())
# figure theme
plot_theme <-   theme_minimal()+
theme(text=element_text(family="sans",size=12,color="black"),
legend.text = element_text(size=14),
axis.title=element_text(family="sans",size=14,color="black"),
axis.text=element_text(family="sans",size=8,color="black"),
panel.grid.major = element_line(color="gray50",linetype=3))
theme_set(plot_theme)
names(cod_dat_raw)
unique(cod_dat_raw$Survey)
unique(cod_dat_raw$Domain)
### Process cod length-frequency data ###
library(tidyverse)
library(here)
here <- here::here()
cod_dat_raw <- read_csv(here("data","race_length_by_haul_PACIFIC_COD.zip"),skip=7,col_types = cols())
# figure theme
plot_theme <-   theme_minimal()+
theme(text=element_text(family="sans",size=12,color="black"),
legend.text = element_text(size=14),
axis.title=element_text(family="sans",size=14,color="black"),
axis.text=element_text(family="sans",size=8,color="black"),
panel.grid.major = element_line(color="gray50",linetype=3))
theme_set(plot_theme)
# remove unnecessary columns and rename
cod_dat <- cod_dat_raw %>%
select(Year,`Haul Join ID`,`Starting Latitude (dd)`,`Starting Longitude (dd)`,`Ending Latitude (dd)`,`Ending Longitude (dd)`, Stratum,
`Satisfactory Gear Performance`,`Bottom Depth`,`Weight (kg)`,`Number of Fish`) %>%
rename(hauljoin=`Haul Join ID`,startlat=`Starting Latitude (dd)`,startlon=`Starting Longitude (dd)`,
endlat=`Ending Latitude (dd)`,endlon=`Ending Longitude (dd)`,gear_satisfactory=`Satisfactory Gear Performance`,depth=`Bottom Depth`,
weight=`Weight (kg)`,number=`Number of Fish`
)
names(cod_dat_raw)
# remove unnecessary columns and rename
cod_dat <- cod_dat_raw %>%
select(Year,`Haul Join ID`,`Starting Latitude (dd)`,`Starting Longitude (dd)`,`Ending Latitude (dd)`,`Ending Longitude (dd)`, Stratum,
`Satisfactory Gear Performance`,`Bottom Depth`,`Scientific Name`,`Length (mm)`,`Frequency`,`Sex`,`Sample Type`,`Length Type`) %>%
rename(hauljoin=`Haul Join ID`,startlat=`Starting Latitude (dd)`,startlon=`Starting Longitude (dd)`,
endlat=`Ending Latitude (dd)`,endlon=`Ending Longitude (dd)`,gear_satisfactory=`Satisfactory Gear Performance`,depth=`Bottom Depth`,
spp=`Scientific Name`,length=`Length (mm)`,frequency=Frequency,sex=sex,sample_type=`Sample Type`,length_type=`Length Type`
)
# remove unnecessary columns and rename
cod_dat <- cod_dat_raw %>%
select(Year,`Haul Join ID`,`Starting Latitude (dd)`,`Starting Longitude (dd)`,`Ending Latitude (dd)`,`Ending Longitude (dd)`, Stratum,
`Satisfactory Gear Performance`,`Bottom Depth`,`Scientific Name`,`Length (mm)`,`Frequency`,`Sex`,`Sample Type`,`Length Type`) %>%
rename(hauljoin=`Haul Join ID`,startlat=`Starting Latitude (dd)`,startlon=`Starting Longitude (dd)`,
endlat=`Ending Latitude (dd)`,endlon=`Ending Longitude (dd)`,gear_satisfactory=`Satisfactory Gear Performance`,depth=`Bottom Depth`,
spp=`Scientific Name`,length=`Length (mm)`,frequency=Frequency,sex=Sex,sample_type=`Sample Type`,length_type=`Length Type`
)
View(cod_dat)
unique(cod_dat$gear_satisfactory)
unique(cod_dat$length_type)
unique(cod_dat$sample_type)
# remove unnecessary columns and rename
cod_dat <- cod_dat_raw %>%
select(Year,`Haul Join ID`,`Starting Latitude (dd)`,`Starting Longitude (dd)`,
`Ending Latitude (dd)`,`Ending Longitude (dd)`, Stratum,
`Bottom Depth`,`Scientific Name`,`Length (mm)`,`Frequency`,
`Sex`,`Sample Type`,`Length Type`) %>%
rename(hauljoin=`Haul Join ID`,startlat=`Starting Latitude (dd)`,startlon=`Starting Longitude (dd)`,
endlat=`Ending Latitude (dd)`,endlon=`Ending Longitude (dd)`,depth=`Bottom Depth`,
spp=`Scientific Name`,length=`Length (mm)`,frequency=Frequency,sex=Sex,
sample_type=`Sample Type`,
length_type=`Length Type`)
unique(cod_dat$Year)
# remove unnecessary columns and rename
cod_dat <- cod_dat_raw %>%
select(Year,`Haul Join ID`,`Starting Latitude (dd)`,`Starting Longitude (dd)`,
`Ending Latitude (dd)`,`Ending Longitude (dd)`, Stratum,
`Bottom Depth`,`Scientific Name`,`Length (mm)`,`Frequency`,
`Sex`,`Sample Type`,`Length Type`) %>%
rename(hauljoin=`Haul Join ID`,startlat=`Starting Latitude (dd)`,startlon=`Starting Longitude (dd)`,
endlat=`Ending Latitude (dd)`,endlon=`Ending Longitude (dd)`,depth=`Bottom Depth`,
spp=`Scientific Name`,length=`Length (mm)`,frequency=Frequency,sex=Sex,
sample_type=`Sample Type`,
length_type=`Length Type`) %>%
mutate(year=as.integer(Year))
unique(cod_dat$year)
# remove unnecessary columns and rename
cod_dat <- cod_dat_raw %>%
select(Year,`Haul Join ID`,`Starting Latitude (dd)`,`Starting Longitude (dd)`,
`Ending Latitude (dd)`,`Ending Longitude (dd)`, Stratum,
`Bottom Depth`,`Scientific Name`,`Length (mm)`,`Frequency`,
`Sex`,`Sample Type`,`Length Type`) %>%
rename(year=Year,hauljoin=`Haul Join ID`,
startlat=`Starting Latitude (dd)`,
startlon=`Starting Longitude (dd)`,
endlat=`Ending Latitude (dd)`,
endlon=`Ending Longitude (dd)`,
depth=`Bottom Depth`,
spp=`Scientific Name`,
length=`Length (mm)`,
frequency=Frequency,
sex=Sex,
sample_type=`Sample Type`,
length_type=`Length Type`) %>%
mutate(year=as.integer(Year))
# remove unnecessary columns and rename
cod_dat <- cod_dat_raw %>%
select(Year,`Haul Join ID`,`Starting Latitude (dd)`,`Starting Longitude (dd)`,
`Ending Latitude (dd)`,`Ending Longitude (dd)`, Stratum,
`Bottom Depth`,`Scientific Name`,`Length (mm)`,`Frequency`,
`Sex`,`Sample Type`,`Length Type`) %>%
rename(year=Year,hauljoin=`Haul Join ID`,
startlat=`Starting Latitude (dd)`,
startlon=`Starting Longitude (dd)`,
endlat=`Ending Latitude (dd)`,
endlon=`Ending Longitude (dd)`,
depth=`Bottom Depth`,
spp=`Scientific Name`,
length=`Length (mm)`,
frequency=Frequency,
sex=Sex,
sample_type=`Sample Type`,
length_type=`Length Type`) %>%
mutate(year=as.integer(year))
unique(cod_dat$year)
# remove unnecessary columns and rename
cod_dat <- cod_dat_raw %>%
select(Year,`Haul Join ID`,`Starting Latitude (dd)`,`Starting Longitude (dd)`,
`Ending Latitude (dd)`,`Ending Longitude (dd)`, Stratum,
`Bottom Depth`,`Scientific Name`,`Length (mm)`,`Frequency`,
`Sex`,`Sample Type`,`Length Type`) %>%
rename(year=Year,hauljoin=`Haul Join ID`,
startlat=`Starting Latitude (dd)`,
startlon=`Starting Longitude (dd)`,
endlat=`Ending Latitude (dd)`,
endlon=`Ending Longitude (dd)`,
depth=`Bottom Depth`,
spp=`Scientific Name`,
length=`Length (mm)`,
frequency=Frequency,
sex=Sex,
sample_type=`Sample Type`,
length_type=`Length Type`) %>%
mutate(year=as.integer(year)) %>%
arrange(year)
unique(cod_dat$year)
class(cod_dat$length)
# add decade
cod_dat <- cod_dat %>%
mutate(decade=case_when(
Year<1990 ~ "1980s",
Year<2000&Year>1989 ~ "1990s",
Year<2010&Year>1999 ~ "2000s",
Year>2009 ~ "2010s"
))
# add decade
cod_dat <- cod_dat %>%
mutate(decade=case_when(
year<1990 ~ "1980s",
year<2000&year>1989 ~ "1990s",
year<2010&year>1999 ~ "2000s",
year>2009 ~ "2010s"
))
## Visualize
cod_dat %>%
ggplot(aes(length,..density..))+
geom_density()+
facet_wrap(decade)
## Visualize
cod_dat %>%
ggplot(aes(length,..density..))+
geom_density()+
facet_wrap(~decade)
head(cod_dat$frequency)
head(cod_dat$length)
sizecomp_all<- cod_dat %>%
ungroup() %>%
ggplot(aes(x=length,y=factor(year),height=frequency))+
geom_density_ridges(stat='identity',fill='blue',alpha=0.5,scale=2,color='black')+
labs(x="Length",y="Year",title="Size Composition")+
facet_wrap(~decade,scales='free_y')
library(ggridges)
sizecomp_all<- cod_dat %>%
ungroup() %>%
ggplot(aes(x=length,y=factor(year),height=frequency))+
geom_density_ridges(stat='identity',fill='blue',alpha=0.5,scale=2,color='black')+
labs(x="Length",y="Year",title="Size Composition")+
facet_wrap(~decade,scales='free_y')
sizecomp_all
hist(cod_dat$frequency)
test <- cod_dat %>% count(year,length)
View(test)
sizecomp_all<- cod_dat %>%
group_by(year,length) %>%
mutate(prop=frequency/sum(frequency)) %>%
ungroup() %>%
ggplot(aes(x=length,y=factor(year),size=prop*100))+
scale_size_continuous(range=c(1,20))+
geom_point(alpha=0.3,color='blue')+
labs(x="Length",y="Year",title="Size Composition",size="Percent")+
xlim(0,100)+
facet_wrap(~decade,scales='free_y')
sizecomp_all
test<-cod_dat %>%
group_by(year,length) %>%
mutate(prop=frequency/sum(frequency)) %>%
ungroup()
View(test)
sizecomp_all<- cod_dat %>%
group_by(year,length) %>%
mutate(prop=frequency/sum(frequency)) %>%
ungroup() %>%
ggplot(aes(x=length,y=factor(year),size=prop*100))+
scale_size_continuous(range=c(1,20))+
geom_point(alpha=0.3,color='blue')+
labs(x="Length",y="Year",title="Size Composition",size="Percent")+
xlim(0,1000)+
facet_wrap(~decade,scales='free_y')
sizecomp_all
test<-cod_dat %>%
group_by(year) %>%
mutate(prop=frequency/sum(frequency)) %>%
ungroup()
View(test)
names(cod_dat_raw)
length(unique(cod_dat_raw$Stratum))
sizecomp_by_year <- cod_dat %>%
group_by(year,length) %>%
summarise(frequency=sum(frequency))
View(sizecomp_by_year)
sizecomp_by_year <- sizecomp_by_year %>%
mutate(decade=case_when(
year<1990 ~ "1980s",
year<2000&year>1989 ~ "1990s",
year<2010&year>1999 ~ "2000s",
year>2009 ~ "2010s"
))
sizecomp_by_year <- cod_dat %>%
group_by(year,length) %>%
summarise(frequency=sum(frequency)) %>%
ungroup() %>%
group_by(year) %>%
mutate(prop=frequency/sum(frequency))
# add decade
cod_dat <- cod_dat %>%
mutate(decade=case_when(
year<1990 ~ "1980s",
year<2000&year>1989 ~ "1990s",
year<2010&year>1999 ~ "2000s",
year>2009 ~ "2010s"
))
sizecomp_by_year <- sizecomp_by_year %>%
mutate(decade=case_when(
year<1990 ~ "1980s",
year<2000&year>1989 ~ "1990s",
year<2010&year>1999 ~ "2000s",
year>2009 ~ "2010s"
))
sizecomp_all<- sizecomp_by_year %>%
ggplot(aes(x=length,y=factor(year),size=prop))+
scale_size_continuous(range=c(1,20))+
geom_point(alpha=0.3,color='blue')+
labs(x="Length",y="Year",title="Size Composition",size="Percent")+
xlim(0,1000)+
facet_wrap(~decade,scales='free_y')
sizecomp_all
sizecomp_all<- sizecomp_by_year %>%
ggplot(aes(x=length,y=factor(year),size=prop*100))+
scale_size_continuous(range=c(1,20))+
geom_point(alpha=0.3,color='blue')+
labs(x="Length",y="Year",title="Size Composition",size="Percent")+
xlim(0,1000)+
facet_wrap(~decade,scales='free_y')
sizecomp_all
sizecomp_all<- sizecomp_by_year %>%
ggplot(aes(x=length,y=factor(year),size=prop*100))+
scale_size_continuous(range=c(1,20),breaks=c(1,2,5,10))+
geom_point(alpha=0.3,color='blue')+
labs(x="Length",y="Year",title="Size Composition",size="Percent")+
xlim(0,1000)+
facet_wrap(~decade,scales='free_y')
sizecomp_all
sizecomp_density_all<-sizecomp_by_year %>%
ungroup() %>%
ggplot(aes(x=length,y=factor(Year),height=prop))+
geom_density_ridges(stat='identity',fill='blue',alpha=0.5,scale=2,color='black')+
labs(x="Length",y="Year",title="Size Composition")+
xlim(0,100)+
facet_wrap(~decade,scales='free_y')
sizecomp_density_all
sizecomp_density_all<-sizecomp_by_year %>%
ungroup() %>%
ggplot(aes(x=length,y=factor(year),height=prop))+
geom_density_ridges(stat='identity',fill='blue',alpha=0.5,scale=2,color='black')+
labs(x="Length",y="Year",title="Size Composition")+
xlim(0,100)+
facet_wrap(~decade,scales='free_y')
sizecomp_density_all
sizecomp_density_all<-sizecomp_by_year %>%
ungroup() %>%
ggplot(aes(x=length,y=factor(year),height=prop))+
geom_density_ridges(stat='identity',fill='blue',alpha=0.5,scale=2,color='black')+
labs(x="Length",y="Year",title="Size Composition")+
xlim(0,1000)+
facet_wrap(~decade,scales='free_y')
sizecomp_density_all
ggsave(plot=sizecomp_bubble_all,"plots/cod_size_comp_bubble.png",height=8,width=10)
ggsave(plot=sizecomp_all,"plots/cod_size_comp_bubble.png",height=8,width=10)
ggsave(plot=sizecomp_density_all,"plots/cod_size_comp_density.png",height=8,width=10)
sizecomp_all<- sizecomp_by_year %>%
ggplot(aes(x=length,y=factor(year),size=prop*100))+
scale_size_continuous(range=c(1,20),breaks=c(1,2,5,10))+
geom_point(alpha=0.3,color='blue')+
labs(x="Length (mm)",y="Year",title="Size Composition",size="Percent")+
xlim(0,1000)+
facet_wrap(~decade,scales='free_y')
sizecomp_all
ggsave(plot=sizecomp_all,"plots/cod_size_comp_bubble.png",height=8,width=10)
sizecomp_density_all<-sizecomp_by_year %>%
ungroup() %>%
ggplot(aes(x=length,y=factor(year),height=prop))+
geom_density_ridges(stat='identity',fill='blue',alpha=0.5,scale=2,color='black')+
labs(x="Length (mm)",y="Year",title="Size Composition")+
xlim(0,1000)+
facet_wrap(~decade,scales='free_y')
sizecomp_density_all
ggsave(plot=sizecomp_density_all,"plots/cod_size_comp_density.png",height=8,width=10)
sizecomp_all<- sizecomp_by_year %>%
ggplot(aes(x=length,y=factor(year),size=prop*100))+
scale_size_continuous(range=c(1,15),breaks=c(1,2,5,10))+
geom_point(alpha=0.3,color='blue')+
labs(x="Length (mm)",y="Year",title="Size Composition",size="Percent")+
xlim(0,1000)+
facet_wrap(~decade,scales='free_y')
sizecomp_all
ggsave(plot=sizecomp_all,"plots/cod_size_comp_bubble.png",height=8,width=10)
?theme
