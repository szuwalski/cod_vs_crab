interpolate_data(df=opi_dat,yr=.x,sex="Male",maturity="Mature",scalelimits=c(0,10),save.plot=TRUE)
}) %>% bind_rows() -> test
?transition_states
test %>%
ggplot()+
geom_raster(aes(x,y,fill=var1.pred),na.rm=T,alpha=0.8,interpolate = TRUE)+
geom_sf(data=ak,fill='gray80')+
# projectRaster(crs="+proj=longlat +datum=WGS84 +no_defs") %>%
# gplot(dat.idw)+
xlim(bbox[1],bbox[3])+ylim(bbox[2],bbox[4])+
labs(x='',y='',fill='Density\n(1000s MT/km2)',title='Year: {closest_state}')+
scale_fill_viridis(na.value=NA,option="C",limits=c(0,10))+
transition_states(year,
transition_length = 1,
state_length=2)
mm.interpolated %>%
ggplot()+
geom_raster(aes(x,y,fill=var1.pred),na.rm=T,alpha=0.8,interpolate = TRUE)+
geom_sf(data=ak,fill='gray80')+
# projectRaster(crs="+proj=longlat +datum=WGS84 +no_defs") %>%
# gplot(dat.idw)+
xlim(bbox[1],bbox[3])+ylim(bbox[2],bbox[4])+
labs(x='',y='',fill='Density\n(1000s MT/km2)',title='Year: {frame_time}')+
scale_fill_viridis(na.value=NA,option="C",limits=c(0,10))+
transition_states(year,
transition_length = 1,
state_length=2) %>%
anim_save("plots/gifs/mature_males.gif")
?ANIM_SAVE
?anim_save
mm.interpolated %>%
ggplot()+
geom_raster(aes(x,y,fill=var1.pred),na.rm=T,alpha=0.8,interpolate = TRUE)+
geom_sf(data=ak,fill='gray80')+
# projectRaster(crs="+proj=longlat +datum=WGS84 +no_defs") %>%
# gplot(dat.idw)+
xlim(bbox[1],bbox[3])+ylim(bbox[2],bbox[4])+
labs(x='',y='',fill='Density\n(1000s MT/km2)',title='Year: {frame_time}')+
scale_fill_viridis(na.value=NA,option="C",limits=c(0,10))+
transition_states(year,
transition_length = 1,
state_length=2) %>%
anim_save(filename="plots/gifs/mature_males.gif",animation=.)
mm.interpolated %>%
ggplot()+
geom_raster(aes(x,y,fill=var1.pred),na.rm=T,alpha=0.8,interpolate = TRUE)+
geom_sf(data=ak,fill='gray80')+
# projectRaster(crs="+proj=longlat +datum=WGS84 +no_defs") %>%
# gplot(dat.idw)+
xlim(bbox[1],bbox[3])+ylim(bbox[2],bbox[4])+
labs(x='',y='',fill='Density\n(1000s MT/km2)',title='Year: {frame_time}')+
scale_fill_viridis(na.value=NA,option="C",limits=c(0,10))+
transition_states(year,
transition_length = 1,
state_length=2)
anim_save(filename="plots/gifs/mature_males.gif")
warnings()
mm.interpolated %>%
ggplot()+
geom_raster(aes(x,y,fill=var1.pred),na.rm=T,alpha=0.8,interpolate = TRUE)+
geom_sf(data=ak,fill='gray80')+
# projectRaster(crs="+proj=longlat +datum=WGS84 +no_defs") %>%
# gplot(dat.idw)+
xlim(bbox[1],bbox[3])+ylim(bbox[2],bbox[4])+
labs(x='',y='',fill='Density\n(1000s MT/km2)',title='Mature Males, {closest_state}')+
scale_fill_viridis(na.value=NA,option="C",limits=c(0,10))+
transition_states(year,
transition_length = 1,
state_length=2)
anim_save(filename="plots/gifs/mature_males.gif")
mm.gif<-mm.interpolated %>%
ggplot()+
geom_raster(aes(x,y,fill=var1.pred),na.rm=T,alpha=0.8,interpolate = TRUE,frame=year)+
geom_sf(data=ak,fill='gray80')+
# projectRaster(crs="+proj=longlat +datum=WGS84 +no_defs") %>%
# gplot(dat.idw)+
xlim(bbox[1],bbox[3])+ylim(bbox[2],bbox[4])+
labs(x='',y='',fill='Density\n(1000s MT/km2)',title='Mature Males, {closest_state}')+
scale_fill_viridis(na.value=NA,option="C",limits=c(0,10))+
transition_states(year,
transition_length = 1,
state_length=2)
mm.gif<-mm.interpolated %>%
ggplot()+
geom_raster(aes(x,y,fill=var1.pred,frame=year),na.rm=T,alpha=0.8,interpolate = TRUE)+
geom_sf(data=ak,fill='gray80')+
# projectRaster(crs="+proj=longlat +datum=WGS84 +no_defs") %>%
# gplot(dat.idw)+
xlim(bbox[1],bbox[3])+ylim(bbox[2],bbox[4])+
labs(x='',y='',fill='Density\n(1000s MT/km2)',title='Mature Males, {closest_state}')+
scale_fill_viridis(na.value=NA,option="C",limits=c(0,10))+
transition_states(year,
transition_length = 1,
state_length=2)
gganimate(mm.gif)
?animate
animate(mm.gif,fps=5)
anim_save(filename="plots/gifs/mature_males.gif")
anim_save(filename="plots/gifs/mature_males.gif",width=800,height=600)
anim_save(filename="plots/gifs/mature_males.gif",width=1000,height=600)
anim_save(filename="plots/gifs/mature_males.gif",ani.width=800,ani.height=600)
animate(mm.gif,fps=5,width=800,height=600)
?transition_time
mm.gif<-mm.interpolated %>%
ggplot()+
geom_raster(aes(x,y,fill=var1.pred,frame=year),na.rm=T,alpha=0.8,interpolate = TRUE)+
geom_sf(data=ak,fill='gray80')+
# projectRaster(crs="+proj=longlat +datum=WGS84 +no_defs") %>%
# gplot(dat.idw)+
xlim(bbox[1],bbox[3])+ylim(bbox[2],bbox[4])+
labs(x='',y='',fill='Density\n(1000s MT/km2)',title='Mature Males, {closest_state}')+
scale_fill_viridis(na.value=NA,option="C",limits=c(0,10))+
transition_time(year)
mm.gif<-mm.interpolated %>%
ggplot()+
geom_raster(aes(x,y,fill=var1.pred,frame=year),na.rm=T,alpha=0.8,interpolate = TRUE)+
geom_sf(data=ak,fill='gray80')+
# projectRaster(crs="+proj=longlat +datum=WGS84 +no_defs") %>%
# gplot(dat.idw)+
xlim(bbox[1],bbox[3])+ylim(bbox[2],bbox[4])+
labs(x='',y='',fill='Density\n(1000s MT/km2)',title='Mature Males, {frame_time}')+
scale_fill_viridis(na.value=NA,option="C",limits=c(0,10))+
transition_time(year)
animate(mm.gif,fps=5,width=800,height=600)
anim_save(filename="plots/gifs/mature_males.gif")
max(mm.interpolated$year)
100/5
100/4
80/2
mm.gif<-mm.interpolated %>%
ggplot()+
geom_raster(aes(x,y,fill=var1.pred,frame=year),na.rm=T,alpha=0.8,interpolate = TRUE)+
geom_sf(data=ak,fill='gray80')+
xlim(bbox[1],bbox[3])+ylim(bbox[2],bbox[4])+
labs(x='',y='',fill='Density\n(1000s MT/km2)',title='Mature Males, {frame_time}')+
scale_fill_viridis(na.value=NA,option="C",limits=c(0,10))+
theme(plot.title = element_text(size=16))+
transition_time(year)
animate(mm.gif,fps=4,width=800,height=600)
anim_save(filename="plots/gifs/mature_males.gif")
### Calculate and save plots (takes a long time)
# For mature males
purrr::map(1982:2017, ~{
interpolate_data(df=opi_dat,yr=.x,sex="Male",maturity="Mature")
}) %>% bind_rows() -> mm.interpolated
# For mature females
purrr::map(1982:2017, ~{
interpolate_data(df=opi_dat,yr=.x,sex="Female",maturity="Mature")
}) %>% bind_rows() -> mf.interpolated
# For immature males
purrr::map(1982:2017, ~{
interpolate_data(df=opi_dat,yr=.x,sex="Male",maturity="Immature")
}) %>% bind_rows() -> im.interpolated
# For immature females
purrr::map(1982:2017, ~{
interpolate_data(df=opi_dat,yr=.x,sex="Female",maturity="Immature")
}) %>% bind_rows() -> if.interpolated
## With gganimate
library(gganimate)
mm.gif<-mm.interpolated %>%
ggplot()+
geom_raster(aes(x,y,fill=var1.pred,frame=year),na.rm=T,alpha=0.8,interpolate = TRUE)+
geom_sf(data=ak,fill='gray80')+
xlim(bbox[1],bbox[3])+ylim(bbox[2],bbox[4])+
labs(x='',y='',fill='Density\n(1000s MT/km2)',title='Mature Males, {frame_time}')+
scale_fill_viridis(na.value=NA,option="C",limits=c(0,10))+
theme(plot.title = element_text(size=16))+
transition_time(year)
animate(mm.gif,fps=4,width=800,height=600)
anim_save(filename="plots/gifs/mature_males.gif")
mf.gif<-mf.interpolated %>%
ggplot()+
geom_raster(aes(x,y,fill=var1.pred,frame=year),na.rm=T,alpha=0.8,interpolate = TRUE)+
geom_sf(data=ak,fill='gray80')+
xlim(bbox[1],bbox[3])+ylim(bbox[2],bbox[4])+
labs(x='',y='',fill='Density\n(1000s MT/km2)',title='Mature Females, {frame_time}')+
scale_fill_viridis(na.value=NA,option="C",limits=c(0,25))+
theme(plot.title = element_text(size=16))+
transition_time(year)
animate(mf.gif,fps=4,width=800,height=600)
anim_save(filename="plots/gifs/mature_females.gif")
im.gif<-im.interpolated %>%
ggplot()+
geom_raster(aes(x,y,fill=var1.pred,frame=year),na.rm=T,alpha=0.8,interpolate = TRUE)+
geom_sf(data=ak,fill='gray80')+
xlim(bbox[1],bbox[3])+ylim(bbox[2],bbox[4])+
labs(x='',y='',fill='Density\n(1000s MT/km2)',title='Immature Males, {frame_time}')+
scale_fill_viridis(na.value=NA,option="C",limits=c(0,10))+
theme(plot.title = element_text(size=16))+
transition_time(year)
animate(im.gif,fps=4,width=800,height=600)
anim_save(filename="plots/gifs/immature_males.gif")
if.gif<-if.interpolated %>%
ggplot()+
geom_raster(aes(x,y,fill=var1.pred,frame=year),na.rm=T,alpha=0.8,interpolate = TRUE)+
geom_sf(data=ak,fill='gray80')+
xlim(bbox[1],bbox[3])+ylim(bbox[2],bbox[4])+
labs(x='',y='',fill='Density\n(1000s MT/km2)',title='Immature Females, {frame_time}')+
scale_fill_viridis(na.value=NA,option="C",limits=c(0,10))+
theme(plot.title = element_text(size=16))+
transition_time(year)
animate(if.gif,fps=4,width=800,height=600)
anim_save(filename="plots/gifs/immature_females.gif")
mf.gif<-mf.interpolated %>%
ggplot()+
geom_raster(aes(x,y,fill=var1.pred,frame=year),na.rm=T,alpha=0.8,interpolate = TRUE)+
geom_sf(data=ak,fill='gray80')+
xlim(bbox[1],bbox[3])+ylim(bbox[2],bbox[4])+
labs(x='',y='',fill='Density\n(1000s MT/km2)',title='Mature Females, {frame_time}')+
scale_fill_viridis(na.value=NA,option="C",limits=c(0,10))+
theme(plot.title = element_text(size=16))+
transition_time(year)
animate(mf.gif,fps=4,width=800,height=600)
anim_save(filename="plots/gifs/mature_females.gif")
bbox
bbox <- bbox*c(0.9,1.1,1.1,0.9)
ggplot()+
geom_raster(data=dat.idw,aes(x,y,fill=var1.pred/1000),na.rm=T,alpha=0.8,interpolate=TRUE)+
geom_sf(data=ak,fill='gray80')+
# projectRaster(crs="+proj=longlat +datum=WGS84 +no_defs") %>%
# gplot(dat.idw)+
xlim(bbox[1],bbox[3])+ylim(bbox[2],bbox[4])+
labs(x='',y='',fill='Density\n(MT/km2)',title=yr)+
scale_fill_viridis(na.value=NA,option="C")
bbox <- st_bbox(dat.sf)
bbox <- bbox*c(0.9,1.1,1.1,0.9) #expand by 10%
mm.gif<-mm.interpolated %>%
ggplot()+
geom_raster(aes(x,y,fill=var1.pred,frame=year),na.rm=T,alpha=0.8,interpolate = TRUE)+
geom_sf(data=ak,fill='gray80')+
xlim(bbox[1],bbox[3])+ylim(bbox[2],bbox[4])+
labs(x='',y='',fill='Density\n(1000s MT/km2)',title='Mature Males, {frame_time}')+
scale_fill_viridis(na.value=NA,option="C",limits=c(0,10))+
theme(plot.title = element_text(size=16))+
transition_time(year)
animate(mm.gif,fps=4,width=800,height=600)
anim_save(filename="plots/gifs/mature_males.gif")
mf.gif<-mf.interpolated %>%
ggplot()+
geom_raster(aes(x,y,fill=var1.pred,frame=year),na.rm=T,alpha=0.8,interpolate = TRUE)+
geom_sf(data=ak,fill='gray80')+
xlim(bbox[1],bbox[3])+ylim(bbox[2],bbox[4])+
labs(x='',y='',fill='Density\n(1000s MT/km2)',title='Mature Females, {frame_time}')+
scale_fill_viridis(na.value=NA,option="C",limits=c(0,10))+
theme(plot.title = element_text(size=16))+
transition_time(year)
animate(mf.gif,fps=4,width=800,height=600)
anim_save(filename="plots/gifs/mature_females.gif")
im.gif<-im.interpolated %>%
ggplot()+
geom_raster(aes(x,y,fill=var1.pred,frame=year),na.rm=T,alpha=0.8,interpolate = TRUE)+
geom_sf(data=ak,fill='gray80')+
xlim(bbox[1],bbox[3])+ylim(bbox[2],bbox[4])+
labs(x='',y='',fill='Density\n(1000s MT/km2)',title='Immature Males, {frame_time}')+
scale_fill_viridis(na.value=NA,option="C",limits=c(0,10))+
theme(plot.title = element_text(size=16))+
transition_time(year)
animate(im.gif,fps=4,width=800,height=600)
anim_save(filename="plots/gifs/immature_males.gif")
if.gif<-if.interpolated %>%
ggplot()+
geom_raster(aes(x,y,fill=var1.pred,frame=year),na.rm=T,alpha=0.8,interpolate = TRUE)+
geom_sf(data=ak,fill='gray80')+
xlim(bbox[1],bbox[3])+ylim(bbox[2],bbox[4])+
labs(x='',y='',fill='Density\n(1000s MT/km2)',title='Immature Females, {frame_time}')+
scale_fill_viridis(na.value=NA,option="C",limits=c(0,10))+
theme(plot.title = element_text(size=16))+
transition_time(year)
animate(if.gif,fps=4,width=800,height=600)
anim_save(filename="plots/gifs/immature_females.gif")
devtools::install_github("James-Thorson/Vast")
library(VAST)
devtools::install_github("James-Thorson/VAST")
devtools::install_github("James-Thorson/VAST")
install.packages('rlang')
devtools::install_github("James-Thorson/VAST")
library(Vast)
devtools::install_github("James-Thorson/VAST")
# devtools command to get TMB from GitHub
install_github("kaskr/adcomp/TMB")
# source script to get INLA from the web
source("http://www.math.ntnu.no/inla/givemeINLA.R")
devtools::install_github("kaskr/adcomp/TMB")
install.packages("INLA", repos=c(getOption("repos"), INLA="https://inla.r-inla-download.org/R/stable"), dep=TRUE)
devtools::install_github("James-Thorson/VAST")
devtools::install_github("James-Thorson/VAST")
library(VAST)
devtools::install_github("James-Thorson/VAST")
# Interpolation, cod data
library(tidyverse)
library(gstat)
library(sf)
library(raster)
library(rasterVis)
library(rgdal)
library(viridis)
# figure theme
plot_theme <-   theme_minimal()+
theme(text=element_text(family="sans",size=12,color="black"),
legend.text = element_text(size=14),
axis.title=element_text(family="sans",size=14,color="black"),
# axis.text=element_blank(),
axis.text=element_text(family="sans",size=8,color="black"),
panel.grid.major = element_line(color="gray50",linetype=3))
theme_set(plot_theme)
# import data
load('data/cod_dat_clean.Rdata')
View(cod_dat_clean)
# convert to simple features (spatial points) object
# transform to a good Bering Sea projection (EPSG code 3571, Lambert azimuthal equal-area)
dat.sf <- st_as_sf(cod_dat_clean,coords=c('midlon','midlat'),crs=4326) %>% st_transform(3571)
dat.sp <- dat.sf %>% as_Spatial()
dat.ch <- st_convex_hull(st_union(dat.sf))
#raster
r <- raster(dat.sp)
res(r) <- 10000 #1 km
# test data
testdat <- cod_dat_clean %>% filter(Year==1982)
# convert to simple features (spatial points) object
# transform to a good Bering Sea projection (EPSG code 3571, Lambert azimuthal equal-area)
dat.sf <- st_as_sf(cod_dat_clean,coords=c('midlon','midlat'),crs=4326) %>% st_transform(3571)
dat.sp <- dat.sf %>% as_Spatial()
dat.ch <- st_convex_hull(st_union(dat.sf))
#raster
r <- raster(dat.sp)
res(r) <- 10000 #1 km
#interpolate using inverse distance weighting
idm<-gstat(formula=density_weight~1,locations=dat.sp)
dat.idw <- interpolate(r,idm) %>% mask(as_Spatial(dat.ch))%>%
as.data.frame(xy=TRUE)
# state outline
ak <- read_sf('data/spatial/cb_2017_02_anrc_500k.shp') %>%
st_union() %>%
st_transform(3571)
#interpolate using inverse distance weighting
idm<-gstat(formula=dens_weight~1,locations=dat.sp)
dat.idw <- interpolate(r,idm) %>% mask(as_Spatial(dat.ch))%>%
as.data.frame(xy=TRUE)
# state outline
ak <- read_sf('data/spatial/cb_2017_02_anrc_500k.shp') %>%
st_union() %>%
st_transform(3571)
bbox <- st_bbox(dat.sf)
bbox <- bbox*c(0.9,1.1,1.1,0.9) #expand by 10%
## function to create a map like the above
interpolate_data <- function(df,yr,sex,maturity) {
#subset data
dat <- df %>%
filter(Year==yr,Sex==sex,Maturity==maturity) %>%
group_by(Year,Lat,Lon) %>%
summarise(density_weight=sum(value/AreaSwept_km2/1e6,na.rm=T)) %>%
ungroup()
# convert to simple features (spatial points) object
dat.sf <- st_as_sf(dat,coords=c('Lon','Lat'),crs=4326) %>% st_transform(3571)
dat.sp <- dat.sf %>% as_Spatial()
dat.ch <- st_convex_hull(st_union(dat.sf))
#interpolate using inverse distance weighting
idm<-gstat(formula=density_weight~1,locations=dat.sp)
dat.idw <- interpolate(r,idm) %>%
mask(as_Spatial(dat.ch)) %>%
as.data.frame(xy=TRUE) %>%
mutate(year=yr)
dat.idw
}
# Test plot
ggplot()+
geom_raster(data=dat.idw,aes(x,y,fill=var1.pred/1000),na.rm=T,alpha=0.8,interpolate=TRUE)+
geom_sf(data=ak,fill='gray80')+
# projectRaster(crs="+proj=longlat +datum=WGS84 +no_defs") %>%
# gplot(dat.idw)+
xlim(bbox[1],bbox[3])+ylim(bbox[2],bbox[4])+
labs(x='',y='',fill='Density\n(MT/km2)',title=yr)+
scale_fill_viridis(na.value=NA,option="C")
# Test plot
ggplot()+
geom_raster(data=dat.idw,aes(x,y,fill=var1.pred/1000),na.rm=T,alpha=0.8,interpolate=TRUE)+
geom_sf(data=ak,fill='gray80')+
# projectRaster(crs="+proj=longlat +datum=WGS84 +no_defs") %>%
# gplot(dat.idw)+
xlim(bbox[1],bbox[3])+ylim(bbox[2],bbox[4])+
labs(x='',y='',fill='Density\n(MT/km2)',title="Test: Cod distribution 1982 interpolated")+
scale_fill_viridis(na.value=NA,option="C")
quantile(cod_dat_clean$dens_weight,c(0.8,0.9,0.95,0.98,1))
# Test plot
ggplot()+
geom_raster(data=dat.idw,aes(x,y,fill=var1.pred/1000),na.rm=T,alpha=0.8,interpolate=TRUE)+
geom_sf(data=ak,fill='gray80')+
# projectRaster(crs="+proj=longlat +datum=WGS84 +no_defs") %>%
# gplot(dat.idw)+
xlim(bbox[1],bbox[3])+ylim(bbox[2],bbox[4])+
labs(x='',y='',fill='Density\n(MT/km2)',title="Test: Cod distribution 1982 interpolated")+
scale_fill_viridis(na.value=NA,option="C",limits=c(0,25))
## function to create a map like the above
interpolate_data <- function(df,yr) {
#subset data
dat <- df %>%
filter(Year==yr)
# convert to simple features (spatial points) object
dat.sf <- st_as_sf(dat,coords=c('midlon','midlat'),crs=4326) %>% st_transform(3571)
dat.sp <- dat.sf %>% as_Spatial()
dat.ch <- st_convex_hull(st_union(dat.sf))
#interpolate using inverse distance weighting
idm<-gstat(formula=density_weight~1,locations=dat.sp)
dat.idw <- interpolate(r,idm) %>%
mask(as_Spatial(dat.ch)) %>%
as.data.frame(xy=TRUE) %>%
mutate(year=yr)
dat.idw
}
### Calculate and save plots (takes a long time)
# For mature males
purrr::map(1982:2017, ~{
interpolate_data(df=cod_dat_clean,yr=.x,)
}) %>% bind_rows() -> cod.interpolated
interpolate_data(df=cod_dat_clean,yr=.x)
### Calculate and save plots (takes a long time)
# For mature males
purrr::map(1982:2017, ~{
interpolate_data(df=cod_dat_clean,yr=.x)
}) %>% bind_rows() -> cod.interpolated
## function to create a map like the above
interpolate_data <- function(df,yr) {
#subset data
dat <- df %>%
filter(Year==yr)
# convert to simple features (spatial points) object
dat.sf <- st_as_sf(dat,coords=c('midlon','midlat'),crs=4326) %>% st_transform(3571)
dat.sp <- dat.sf %>% as_Spatial()
dat.ch <- st_convex_hull(st_union(dat.sf))
#interpolate using inverse distance weighting
idm<-gstat(formula=dens_weight~1,locations=dat.sp)
dat.idw <- interpolate(r,idm) %>%
mask(as_Spatial(dat.ch)) %>%
as.data.frame(xy=TRUE) %>%
mutate(year=yr)
dat.idw
}
### Calculate and save plots (takes a long time)
# For mature males
purrr::map(1982:2017, ~{
interpolate_data(df=cod_dat_clean,yr=.x)
}) %>% bind_rows() -> cod.interpolated
## With gganimate
library(gganimate)
cod.gif<-cod.interpolated %>%
ggplot()+
geom_raster(aes(x,y,fill=var1.pred,frame=year),na.rm=T,alpha=0.8,interpolate = TRUE)+
geom_sf(data=ak,fill='gray80')+
xlim(bbox[1],bbox[3])+ylim(bbox[2],bbox[4])+
labs(x='',y='',fill='Density\n(MT/km2)',title='Cod Density, {frame_time}')+
scale_fill_viridis(na.value=NA,option="C",limits=c(0,10))+
theme(plot.title = element_text(size=16))+
transition_time(year)
animate(cod.gif,fps=4,width=800,height=600)
View(cod.interpolated)
cod.interpolated %>% filter(Year==2017) %>%
ggplot()+
geom_raster(aes(x,y,fill=var1.pred),na.rm=T,alpha=0.8,interpolate = TRUE)+
geom_sf(data=ak,fill='gray80')+
xlim(bbox[1],bbox[3])+ylim(bbox[2],bbox[4])+
labs(x='',y='',fill='Density\n(MT/km2)',title='Cod Density, {frame_time}')+
scale_fill_viridis(na.value=NA,option="C",limits=c(0,10))+
theme(plot.title = element_text(size=16))
cod.interpolated %>% filter(year==2017) %>%
ggplot()+
geom_raster(aes(x,y,fill=var1.pred),na.rm=T,alpha=0.8,interpolate = TRUE)+
geom_sf(data=ak,fill='gray80')+
xlim(bbox[1],bbox[3])+ylim(bbox[2],bbox[4])+
labs(x='',y='',fill='Density\n(MT/km2)',title='Cod Density, {frame_time}')+
scale_fill_viridis(na.value=NA,option="C",limits=c(0,10))+
theme(plot.title = element_text(size=16))
bbox
# Test plot
ggplot()+
geom_raster(data=dat.idw,aes(x,y,fill=var1.pred/1000),na.rm=T,alpha=0.8,interpolate=TRUE)+
geom_sf(data=ak,fill='gray80')+
# projectRaster(crs="+proj=longlat +datum=WGS84 +no_defs") %>%
# gplot(dat.idw)+
xlim(bbox[1],bbox[3])+ylim(bbox[2],bbox[4])+
labs(x='',y='',fill='Density\n(MT/km2)',title="Test: Cod distribution 1982 interpolated")+
scale_fill_viridis(na.value=NA,option="C",limits=c(0,25))
cod.interpolated %>% filter(year==2017) %>%
ggplot()+
geom_raster(aes(x,y,fill=var1.pred/1000),na.rm=T,alpha=0.8,interpolate = TRUE)+
geom_sf(data=ak,fill='gray80')+
xlim(bbox[1],bbox[3])+ylim(bbox[2],bbox[4])+
labs(x='',y='',fill='Density\n(MT/km2)',title='Cod Density, {frame_time}')+
scale_fill_viridis(na.value=NA,option="C",limits=c(0,10))+
theme(plot.title = element_text(size=16))
cod.interpolated %>% filter(year==2017) %>%
ggplot()+
geom_raster(aes(x,y,fill=var1.pred/1000),na.rm=T,alpha=0.8,interpolate = TRUE)+
geom_sf(data=ak,fill='gray80')+
xlim(bbox[1],bbox[3])+ylim(bbox[2],bbox[4])+
labs(x='',y='',fill='Density\n(MT/km2)',title='Cod Density, {frame_time}')+
scale_fill_viridis(na.value=NA,option="C",limits=c(0,25))+
theme(plot.title = element_text(size=16))
cod.gif<-cod.interpolated %>%
ggplot()+
geom_raster(aes(x,y,fill=var1.pred/1000,frame=year),na.rm=T,alpha=0.8,interpolate = TRUE)+
geom_sf(data=ak,fill='gray80')+
xlim(bbox[1],bbox[3])+ylim(bbox[2],bbox[4])+
labs(x='',y='',fill='Density\n(MT/km2)',title='Cod Density, {frame_time}')+
scale_fill_viridis(na.value=NA,option="C",limits=c(0,25))+
theme(plot.title = element_text(size=16))+
transition_time(year)
animate(cod.gif,fps=4,width=800,height=600)
anim_save(filename="plots/gifs/cod.gif")
devtools::install_github("james-thorson/VAST")
library(VAST)
?VAST
devtools::install_github("james-thorson/utilities")
